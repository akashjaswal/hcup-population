{
  "name": "Hcup-population",
  "tagline": "Washington State Hospitalization and Vaccination (HCUP) - Building Fixed Effect Models",
  "body": "\r\n### About Healthcare Cost and Utilization Project (HCUP):\r\n\r\nHCUP is the Nationâ€™s most comprehensive source of hospital data, including information on in-patient care, ambulatory care, and emergency department visits. HCUP enables researchers, insurers, policymakers and others to study health care delivery and patient outcomes over time, and at the national, regional, State, and community levels. For details about this initiative [see](http://www.hcup-us.ahrq.gov/)\r\n\r\n####Working with Data\r\n  1. WA State Hospitalization Records (Last 10 years, over 5.7 million records)\r\n  2. WA State Vaccination Data (reliable monthly data 2004 onwards, all zipcodes)\r\n  3. WA State Population Census and Demographics (24 years, all county data aggregated at AgeGroup and Gender Level)\r\n\r\n\r\n\r\n####Project Overview and Data Preparation Workflow\r\n  - Step 1: Scraping Population and Demographics data from WA State by County, AgeGroup, Gender, Year - Past 3 decades. Data Scraped from [here](http://www.census.gov/popest/data/intercensal/index.html) (Script language: Python)\r\n  - Step 2: Interpolated data for Month, Year from the Deccenial Intercensal Population Data: Linear Method for Interpolation used.(Script language: Python)\r\n  - Step 3: Cleaning Vaccination Data by mapping Zip codes to Counties in WA and dividing year and month numerals. (Script language: Python)\r\n  - Step 4: Loading Hospitalization data from RDat files and filter variables: age, female, ayear, amonth, pstco2, zip (Script Language: R)\r\n  - Step 5: Map every hospitalized patient to an age group ranging from 1 to 18 based on their age during the time of admission.\r\n  - Step 6: Aggregate Hospitalizations by Gender, AgeGroup, Year, Month and pstco2 (FIPS) -- FIPS represents the relationship between county and Zip code.\r\n  - Step 7: For our vaccination fixed effects model, we only use age group 0-4 years (agegroup1). Filter Data corresponding to age group 1 for population dataset and hospitalization dataset (Script Language: Python)\r\n  - Step 8: Merge and Join datasets -- Population, Hospitalization and Vaccination on Year, Month, County, AgeGroup. \r\n  - Step 9: Normalized the all-cause hospitalization and all vaccination count by dividing by corresponding population figures of the month, year in the related county.\r\n  - Step 10: Exploratory Analysis and Plotting Lattices for overview. \r\n  - Step 11: Statistical Analysis and Fixed Effects Model fitting.\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n# Importing Packages\r\nlibrary(tidyverse)\r\nlibrary(plm)\r\nlibrary(ggplot2)\r\nlibrary(lattice)\r\n\r\n```\r\n\r\n### 1. Importing Data\r\n\r\n#### 1.1 Reading Inpatient Hospitalization Data\r\n\r\nVariable encoding scheme and definitions for HCUP Data: [here](https://www.hcup-us.ahrq.gov/db/state/siddist/sid_multivar.jsp)\r\n\r\n```{r}\r\nsetwd(\"~/Desktop/AkashPersonal/hcup-population\")\r\n\r\n# Reading the Hospitalization Data\r\nhosp.data <- NULL\r\nfor (year in seq(2004,2013,by=1)) {\r\n  \r\n  # path name on how to read the file  \r\n  file <- paste('data/HospData/WA_SIDC_',year,'_CORE','.rdat',sep='')\r\n  print (c(\"Reading data from\", file))\r\n  \r\n  # Loading RDat files and Appending to DF \r\n  load(file)\r\n  cols <- c(\"ayear\",\"amonth\",\"pstco2\",\"zip\",\"pl_ur_cat4\",\"age\",\"female\",\"dx1\",\"dxccs1\")\r\n  temp <- data.frame(temp)[cols]\r\n  hosp.data <- rbind(hosp.data,temp)\r\n  \r\n  # Tabular Dataframe\r\n  hosp.data <- tbl_df(hosp.data)\r\n}\r\n\r\n```\r\n\r\n#### 1.2 Importing Vaccination Data and Census Demographics\r\n\r\n```{r}\r\n\r\nvaccine.data <- read.csv('~/Desktop/AkashPersonal/hcup-population/data/Vaccine_clean_data.csv')\r\ncensus.data <- read.csv('~/Desktop/AkashPersonal/hcup-population/data/Final_Population_Interpolated.csv')\r\n\r\n```\r\n\r\n### 2. Data Wrangling\r\n\r\n#### 2.1 Data Type Casting\r\n\r\n```{r, warning=FALSE}\r\n# Recasting Variables appropriately - Hospitalization\r\nhosp.data$zip <- as.integer(hosp.data$zip)\r\nhosp.data$dx1 <- as.integer(hosp.data$dx1)\r\nhosp.data$pl_ur_cat4 <- as.integer(hosp.data$pl_ur_cat4)\r\nhosp.data <- hosp.data %>% \r\n  mutate(urban_rural=ifelse(pl_ur_cat4==1, \"Large Metropolitan\", \r\n                            ifelse(pl_ur_cat4==2, \"Small Metropolitan\", \r\n                            ifelse(pl_ur_cat4==3, \"Micropolitan\",\r\n                                   \"Not Metro/Micro\"))))\r\nhosp.data$urban_rural <- as.factor(hosp.data$urban_rural)\r\n\r\n# Demographic data from US Census (Monthly Interpolated by WA County)\r\ncensus.data$year <- as.integer(census.data$year)\r\n\r\n```\r\n\r\n#### 2.2 Filtering, Aggregating and Mapping Data\r\n\r\n```{r}\r\n\r\n# Filtering, Aggregating and Summarizing Hosp Data\r\nhosp.filtered <- hosp.data %>% \r\n  filter(age >= 0 & age <= 4 & ayear >= 2004) %>%\r\n  mutate(AgeGroup=1) %>%\r\n  group_by(ayear, amonth, zip, pstco2, dx1, dxccs1, AgeGroup, urban_rural) %>%\r\n  summarise(hospitalizations=n())\r\n\r\n# Zip Code - County FIPS Mapping\r\nzip.fips.mapping <- hosp.data %>% \r\n  select(zip, pstco2) %>%\r\n  group_by(zip, pstco2) %>%\r\n  summarise(n())\r\n\r\n# Mapping the FIPS County codes to Zip Codes in Vaccine Data\r\nvaccine.data <- merge(vaccine.data, zip.fips.mapping[c('zip','pstco2')], \r\n                      by.x=c(\"ADDRESS_ZIP\"), by.y=c(\"zip\"))\r\nvaccine.data <- vaccine.data[ , !duplicated(colnames(vaccine.data))]\r\n\r\n# Cleaning Census Data\r\ncensus.clean <- census.data %>%\r\n  select(year, month, County, FIPS, AgeGroup, Population) %>%\r\n  group_by(year, month, County, FIPS, AgeGroup) %>%\r\n  summarise(Population=sum(Population))\r\n\r\n```\r\n\r\n### 3. Building Fixed Effect Models\r\n\r\n#### 3.1 All Cause Hospitalization - Vaccination Fixed Effects\r\n\r\n```{r}\r\n\r\n# All Cause Hospitalization\r\nall.cause.hosp <- hosp.filtered %>%\r\n  select(ayear, amonth, AgeGroup, hospitalizations, pstco2, urban_rural) %>%\r\n  group_by(ayear, amonth, pstco2, AgeGroup,urban_rural) %>%\r\n  summarise(patients=sum(hospitalizations))\r\n\r\nall.cause.hosp <- merge(all.cause.hosp, census.clean, by.x=c(\"ayear\",\"amonth\",\"pstco2\",\"AgeGroup\"),\r\n                       by.y=c(\"year\",\"month\",\"FIPS\",\"AgeGroup\"))\r\nall.cause.hosp <- mutate(all.cause.hosp, hosp_norm = patients/Population)\r\n\r\nnames(all.cause.hosp)[1] <- 'year'\r\nnames(all.cause.hosp)[2] <- 'month'\r\nnames(all.cause.hosp)[3] <- 'FIPS'\r\n\r\nvaccine.filtered <- vaccine.data %>%\r\n  select(year, month, FIPS=pstco2, X4313314.SERIES, TOTAL.POPULATION) %>%\r\n  group_by(year, month, FIPS) %>%\r\n  summarise(X4313314_Norm=sum(X4313314.SERIES)/sum(TOTAL.POPULATION),\r\n            X4313314=sum(X4313314.SERIES), TOTAL_POPULATION=sum(TOTAL.POPULATION))\r\n\r\nall.cause.merge <- merge(all.cause.hosp, vaccine.filtered, by=c(\"year\",\"month\",\"FIPS\"))\r\nall.cause.merge$t_index <- interaction(all.cause.merge$year, all.cause.merge$month,sep=\".\")\r\nsummary(all.cause.merge)\r\n```\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n# Plotting the data\r\nggplot(all.cause.merge, aes(X4313314_Norm,hosp_norm)) + geom_point(alpha=0.2) +\r\n  geom_smooth() + theme_minimal(base_size = 8)\r\n\r\nxyplot(hosp_norm ~ X4313314_Norm  | factor(County), data=all.cause.merge, \r\n       pch=19, type=c(\"p\",\"r\"), alpha = 0.2, \r\n       main=list(label=\"All Cause Hospitalization Trends by County Category\",cex=0.8),\r\n       sub=list(label=\"11\",cex=0.1),\r\n       par.settings=simpleTheme(col=\"#59ABE3\", col.line=\"red\"),\r\n       par.strip.text=list(cex=0.5))\r\n\r\n```\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n# Fixed Effects All Cause Hospitalization\r\nfe.all.cause <- plm(hosp_norm ~ X4313314_Norm, data = all.cause.merge, \r\n                    index = c(\"FIPS\", \"t_index\"), model = \"within\", effect = \"individual\")\r\n\r\nsummary(fe.all.cause)\r\nsummary(fixef(fe.all.cause))\r\nfixef.all.cause <- matrix(fixef(fe.all.cause))\r\nfixef.df <- as.data.frame(cbind(sort(unique(all.cause.merge$FIPS)), fixef.all.cause))\r\ncolnames(fixef.df) <- c(\"FIPS\",\"coeff\")\r\nfixef.df$FIPS <- as.character(fixef.df$FIPS)\r\nfixef.df <- mutate(fixef.df, id=substr(FIPS, 3,5))\r\nfixef.df <- fixef.df[c(\"coeff\",'id')]\r\n\r\n```\r\n\r\n\r\n```{r message=FALSE, message=FALSE, warning=FALSE}\r\n# Setting up Mapping Libraries\r\nlibrary(GGally)\r\nlibrary(rgdal)\r\nlibrary(ggmap)\r\nlibrary(rgeos)\r\nlibrary(broom)\r\nlibrary(Cairo)\r\nlibrary(maptools)\r\nlibrary(maps)\r\nlibrary(choroplethr)\r\n\r\n```\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n\r\n# Loading Shapefiles and boundaries\r\nmap.shapefile <- readOGR(dsn = \"/Users/ajaswal/Desktop/hcup-population/Shapefiles/tl_2013_53_cousub\", \r\n                         layer = \"tl_2013_53_cousub\")\r\nmap.df <- fortify(map.shapefile, region=\"COUNTYFP\") \r\n```\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\nmap.df.merge <- merge(map.df,fixef.df, by=\"id\") \r\nggplot() +\r\n  geom_polygon(data = map.df.merge, aes(x = long, y = lat, group = group,\r\n        fill = coeff), color = NA) + \r\n  theme_minimal(base_size = 8) + coord_map() +\r\n  scale_fill_distiller(palette = \"YlOrRd\") +\r\n  ggtitle(\"Fixed Effect Coefficients for X4313314_Norm on \r\n          All Cause Hospitalization for Kids - Within County\")\r\n\r\n# Trying Google Maps Overlay\r\nmap <- get_map(\"WA State\", zoom = 7, maptype = \"roadmap\")\r\np <- ggmap(map)\r\np + geom_polygon(data = map.df.merge, aes(x = long, y = lat, group = group,\r\n  fill = coeff), color = \"grey\", size=0.1, alpha=0.6) +\r\n  scale_fill_distiller(palette = \"YlOrRd\") + \r\n  ggtitle(\"WA State Counties-All Cause Hospitalization\") +\r\n  theme_minimal(base_size = 8)\r\n\r\n```\r\n\r\n\r\n### Now Running Fixed Effects for Specific Type of Diagnosis\r\n\r\n#### Single-Level CCS - Diagnoses: [Codes](https://www.hcup-us.ahrq.gov/toolssoftware/ccs/CCSCategoryNames_FullLabels.pdf)\r\n\r\n#### Diagnoses related to Respiratory Diseases\r\n\r\n- 122 Pneumonia (except that caused by tuberculosis or sexually transmitted disease)\r\n- 123 Influenza\r\n- 124 Acute and chronic tonsillitis\r\n- 125 Acute bronchitis\r\n- 126 Other upper respiratory infections\r\n- 127 Chronic obstructive pulmonary disease and bronchiectasis\r\n- 128 Asthma\r\n- 129 Aspiration pneumonitis; food/vomitus\r\n- 130 Pleurisy; pneumothorax; pulmonary collapse\r\n- 131 Respiratory failure; insufficiency; arrest (adult)\r\n- 132 Lung disease due to external agents\r\n- 133 Other lower respiratory disease\r\n- 134 Other upper respiratory disease\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n# Filtering only Diagnoses related to Respiratory Diseases\r\nhosp.resp <- hosp.filtered %>%\r\n  select(ayear, amonth, zip, pstco2, AgeGroup, urban_rural, hospitalizations, dxccs1) %>%\r\n  filter(dxccs1 >= 122 & dxccs1 <= 134)\r\n\r\n# Aggregating\r\nhosp.resp <- hosp.resp[c(\"ayear\",\"amonth\",\"pstco2\",\"hospitalizations\",\"AgeGroup\")]\r\nhosp.resp <- aggregate(hospitalizations~ayear+amonth+pstco2+AgeGroup, data=hosp.resp, sum)\r\n\r\n# Joining population for normalization\r\nhosp.resp <- merge(hosp.resp, census.clean, by.x=c(\"ayear\",\"amonth\",\"pstco2\",\"AgeGroup\"),\r\n                       by.y=c(\"year\",\"month\",\"FIPS\",\"AgeGroup\"))\r\nhosp.resp <- mutate(hosp.resp, resp_hosp_norm = hospitalizations/Population)\r\nnames(hosp.resp)[1] <- 'year'\r\nnames(hosp.resp)[2] <- 'month'\r\nnames(hosp.resp)[3] <- 'FIPS'\r\n\r\n# Respiratory Hospitalizations\r\nresp.merge <- merge(hosp.resp, vaccine.filtered, by=c(\"year\",\"month\",\"FIPS\"))\r\nresp.merge$t_index <- interaction(resp.merge$year, resp.merge$month,sep=\".\")\r\n```\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n# Plotting the data\r\nggplot(resp.merge , aes(X4313314_Norm,resp_hosp_norm)) + \r\n  geom_point(alpha=0.1) + geom_smooth() + theme_minimal(base_size = 8) +\r\n  ggtitle(\"Hospitalizations related to Respiratory Problems\")\r\n\r\nxyplot(resp_hosp_norm ~ X4313314_Norm | factor(County), data=resp.merge, \r\n       pch=19, type=c(\"p\",\"r\"), alpha = 0.1, \r\n       main=list(label=\"Hospitalizations related to Respiratory Problems By County\",cex=0.8),\r\n       sub=list(label=\"11\",cex=0.1),\r\n       par.settings=simpleTheme(col=\"#59ABE3\", col.line=\"red\"),\r\n       par.strip.text=list(cex=0.5))\r\n```\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n# Fixed Effects Respiratory related Hospitalization\r\nfe.resp <- plm(resp_hosp_norm ~ X4313314_Norm, data = resp.merge, \r\n               index = c(\"FIPS\", \"t_index\"), model = \"within\", effect = \"individual\")\r\n\r\nsummary(fe.resp)\r\nsummary(fixef(fe.resp))\r\nfixef.resp <- matrix(fixef(fe.resp))\r\nfixef.resp.df <- as.data.frame(cbind(sort(unique(resp.merge$FIPS)), fixef.resp))\r\ncolnames(fixef.resp.df) <- c(\"FIPS\",\"coeff\")\r\nfixef.resp.df$FIPS <- as.character(fixef.resp.df$FIPS)\r\nfixef.resp.df <- mutate(fixef.resp.df, id=substr(FIPS, 3,5))\r\nfixef.resp.df <- fixef.resp.df[c(\"coeff\",'id')]\r\n\r\n```\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n# Choropleth for Respiratory related diagnoses\r\nmap.df.merge <- merge(map.df,fixef.resp.df, by=\"id\") \r\nggplot() +\r\n  geom_polygon(data = map.df.merge, aes(x = long, y = lat, group = group,\r\n        fill = coeff), color = NA) + \r\n  theme_minimal(base_size = 8) + coord_map() +\r\n  scale_fill_distiller(palette = \"YlOrRd\") +\r\n  ggtitle(\"Fixed Effect Coefficients for X4313314_Norm on \r\n          Respiratory related Hospitalization for Kids - Within County\")\r\n\r\n```\r\n\r\n\r\n#### Diagnoses not related to Vaccinations \r\n\r\n- 226 Fracture of neck of femur (hip)\r\n- 227 Spinal cord injury\r\n- 228 Skull and face fractures\r\n- 229 Fracture of upper limb\r\n- 230 Fracture of lower limb\r\n- 231 Other fractures\r\n- 232 Sprains and strains\r\n- 233 Intracranial injury\r\n- 234 Crushing injury or internal injury\r\n- 235 Open wounds of head; neck; and trunk\r\n- 236 Open wounds of extremities\r\n- 237 Complication of device; implant or graft\r\n- 238 Complications of surgical procedures or medical care\r\n- 239 Superficial injury; contusion\r\n- 240 Burns\r\n- 241 Poisoning by psychotropic agents\r\n- 242 Poisoning by other medications and drugs\r\n- 243 Poisoning by nonmedicinal substances\r\n- 244 Other injuries and conditions due to external causes\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n# Filtering only Diagnoses related to Non-Respiratory Generic Diseases\r\nhosp.general <- hosp.filtered %>%\r\n  select(ayear, amonth, zip, pstco2, AgeGroup, urban_rural, hospitalizations, dxccs1) %>%\r\n  filter(dxccs1 >= 226 & dxccs1 <= 244)\r\n\r\n# Aggregating\r\nhosp.general <- hosp.general[c(\"ayear\",\"amonth\",\"pstco2\",\"hospitalizations\",\"AgeGroup\")]\r\nhosp.general <- aggregate(hospitalizations~ayear+amonth+pstco2+AgeGroup, \r\n                          data=hosp.general, sum)\r\n\r\n# Joining population for normalization\r\nhosp.general <- merge(hosp.general, census.clean, \r\n                      by.x=c(\"ayear\",\"amonth\",\"pstco2\",\"AgeGroup\"),\r\n                      by.y=c(\"year\",\"month\",\"FIPS\",\"AgeGroup\"))\r\nhosp.general <- mutate(hosp.general, gen_hosp_norm = hospitalizations/Population)\r\nnames(hosp.general)[1] <- 'year'\r\nnames(hosp.general)[2] <- 'month'\r\nnames(hosp.general)[3] <- 'FIPS'\r\n\r\n# Respiratory Hospitalizations\r\ngen.merge <- merge(hosp.general, vaccine.filtered, by=c(\"year\",\"month\",\"FIPS\"))\r\ngen.merge$t_index <- interaction(gen.merge$year, gen.merge$month,sep=\".\")\r\n```\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n# Plotting the data\r\nggplot(gen.merge , aes(X4313314_Norm,gen_hosp_norm)) + \r\n  geom_point(alpha=0.1) + geom_smooth() + theme_minimal(base_size = 8) +\r\n  ggtitle(\"Generic Hospitalizations\")\r\n\r\nxyplot(gen_hosp_norm ~ X4313314_Norm | factor(County), data=gen.merge, \r\n       pch=19, type=c(\"p\",\"r\"), alpha = 0.1, \r\n       main=list(label=\"Generic Hospitalizations By County\",cex=0.8),\r\n       sub=list(label=\"11\",cex=0.1),\r\n       par.settings=simpleTheme(col=\"#59ABE3\", col.line=\"red\"),\r\n       par.strip.text=list(cex=0.5))\r\n```\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n# Fixed Effects - Generic Hospitalizations\r\nfe.gen <- plm(gen_hosp_norm ~ X4313314_Norm, data = gen.merge, \r\n              index = c(\"FIPS\", \"t_index\"), model = \"within\", effect = \"individual\")\r\nsummary(fe.gen)\r\nsummary(fixef(fe.gen))\r\nfixef.gen <- matrix(fixef(fe.gen))\r\nfixef.gen.df <- as.data.frame(cbind(sort(unique(gen.merge$FIPS)), fixef.gen))\r\ncolnames(fixef.gen.df) <- c(\"FIPS\",\"coeff\")\r\nfixef.gen.df$FIPS <- as.character(fixef.gen.df$FIPS)\r\nfixef.gen.df <- mutate(fixef.gen.df, id=substr(FIPS,3,5))\r\nfixef.gen.df <- fixef.gen.df[c(\"coeff\",'id')]\r\n\r\n```\r\n\r\n```{r, message=FALSE, warning=FALSE}\r\n# Choropleth for Respiratory related diagnoses\r\nmap.df.merge <- merge(map.df,fixef.gen.df, by=\"id\") \r\nggplot() +\r\n  geom_polygon(data = map.df.merge, aes(x = long, y = lat, group = group,\r\n        fill = coeff), color = NA) + \r\n  theme_minimal(base_size = 8) + coord_map() +\r\n  scale_fill_distiller(palette = \"YlOrRd\") +\r\n  ggtitle(\"Fixed Effect Coefficients for X4313314_Norm on \r\n          Non-Respiratory related Generic Hospitalization for Kids - Within County\")\r\n\r\n```\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}